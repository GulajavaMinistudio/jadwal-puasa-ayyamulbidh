!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const a of t)if("childList"===a.type)for(const t of a.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const t={TIME:{SECOND_IN_MS:1e3,MINUTE_IN_MS:6e4,HOUR_IN_MS:36e5,DAY_IN_MS:864e5},CACHE:{PRAYER_TIMES_MAX_AGE:864e5,HIJRI_DATE_MAX_AGE:864e5,DEFAULT_MAX_AGE:36e5},INTERVALS:{SECOND:1e3,PRAYER_COUNTDOWN_UPDATE:6e4,DATA_REFRESH:36e5},API:{BASE_URL:"https://api.aladhan.com/v1",DEFAULT_METHOD:99,TIMEOUT:1e4,KEMENAG_CUSTOM:{method:99,methodSettings:"20,null,18",tune:"2,2,0,3,2,8,0,3,0"}},AYYAMUL_BIDH:{DATES:[13,14,15],DAYS_PER_MONTH:3,MONTHS_PER_YEAR:12,TOTAL_DAYS_PER_YEAR:36},STORAGE_KEYS:{APP_CONFIG:"app_config",FASTING_DATA:"puasa_ayyamul_bidh",CACHE:"cache"},VALIDATION:{LATITUDE_MIN:-90,LATITUDE_MAX:90,LONGITUDE_MIN:-180,LONGITUDE_MAX:180,HIJRI_DAY_MIN:1,HIJRI_DAY_MAX:30,HIJRI_MONTH_MIN:1,HIJRI_MONTH_MAX:12,HIJRI_YEAR_MIN:1300,HIJRI_YEAR_MAX:1600,MAX_STREAK_CALCULATION:24},PRAYER_METHODS:[{value:99,label:"Kementerian Agama RI (Akurat - Recommended)",isCustom:!0},{value:20,label:"Kementerian Agama RI (Standard Aladhan)"},{value:3,label:"Muslim World League (MWL)"},{value:2,label:"Islamic Society of North America (ISNA)"},{value:5,label:"Egyptian General Authority of Survey"},{value:4,label:"Umm Al-Qura University, Makkah"},{value:1,label:"University of Islamic Sciences, Karachi"},{value:7,label:"Institute of Geophysics, University of Tehran"}]},e={validateHijriDate(e){if(!e||"object"!=typeof e)return{valid:!1,data:null,error:"Invalid hijri data structure"};const{day:a,month:r,year:n,monthName:i,formatted:o}=e,s=parseInt(a);if(isNaN(s)||s<t.VALIDATION.HIJRI_DAY_MIN||s>t.VALIDATION.HIJRI_DAY_MAX)return{valid:!1,data:null,error:"Invalid Hijri day: ".concat(a)};const c=parseInt(r);if(isNaN(c)||c<t.VALIDATION.HIJRI_MONTH_MIN||c>t.VALIDATION.HIJRI_MONTH_MAX)return{valid:!1,data:null,error:"Invalid Hijri month: ".concat(r)};const l=parseInt(n);return isNaN(l)||l<t.VALIDATION.HIJRI_YEAR_MIN||l>t.VALIDATION.HIJRI_YEAR_MAX?{valid:!1,data:null,error:"Invalid Hijri year: ".concat(n)}:"string"!=typeof i||""===i.trim()?{valid:!1,data:null,error:"Invalid month name"}:"string"!=typeof o||""===o.trim()?{valid:!1,data:null,error:"Invalid formatted date"}:{valid:!0,data:{day:s,month:c,monthName:this.sanitizeString(i),year:l,formatted:this.sanitizeString(o)},error:null}},validatePrayerTimings(t){if(!t||"object"!=typeof t)return{valid:!1,data:null,error:"Invalid timings structure"};const e=["Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha","Imsak"],a={};for(const r of e){if(!t[r])return{valid:!1,data:null,error:"Missing ".concat(r," time")};const e=String(t[r]);if(!this.isValidTimeFormat(e))return{valid:!1,data:null,error:"Invalid time format for ".concat(r,": ").concat(e)};const n=e.replace(/\s*\([^)]*\)\s*$/,"").trim();a[r]=n}return t.Midnight&&this.isValidTimeFormat(String(t.Midnight))&&(a.Midnight=String(t.Midnight)),{valid:!0,data:a,error:null}},validateDateData(t){var e,a,r,n;if(!t||"object"!=typeof t)return{valid:!1,data:null,error:"Invalid date structure"};const i={};if(t.gregorian){const a=t.gregorian;i.gregorian={date:this.sanitizeString(a.date||""),day:this.sanitizeString(a.day||""),month:this.sanitizeString((null==(e=a.month)?void 0:e.en)||""),year:this.sanitizeString(a.year||"")}}if(t.hijri){const e=t.hijri;i.hijri={date:this.sanitizeString(e.date||""),day:this.sanitizeString(e.day||""),month:{en:this.sanitizeString((null==(a=e.month)?void 0:a.en)||""),ar:this.sanitizeString((null==(r=e.month)?void 0:r.ar)||""),number:parseInt(null==(n=e.month)?void 0:n.number)||0},year:this.sanitizeString(e.year||"")}}return t.readable&&(i.readable=this.sanitizeString(t.readable)),{valid:!0,data:i,error:null}},validateStorageData(t,e){if(!t||"object"!=typeof t)return{valid:!1,data:null,error:"Invalid storage data"};if(Object.prototype.hasOwnProperty.call(t,"__proto__")||Object.prototype.hasOwnProperty.call(t,"constructor")||Object.prototype.hasOwnProperty.call(t,"prototype"))return{valid:!1,data:null,error:"Potential prototype pollution detected"};switch(e){case"config":return this.validateConfigData(t);case"fasting":return this.validateFastingData(t);case"cache":return this.validateCacheData(t);default:return{valid:!0,data:this.deepClone(t),error:null}}},validateConfigData(e){const a={};if(e.location){if(a.location={},e.location.city&&(a.location.city=this.sanitizeString(e.location.city)),e.location.country&&(a.location.country=this.sanitizeString(e.location.country)),void 0!==e.location.latitude&&void 0!==e.location.longitude){const r=parseFloat(e.location.latitude),n=parseFloat(e.location.longitude);!isNaN(r)&&!isNaN(n)&&r>=t.VALIDATION.LATITUDE_MIN&&r<=t.VALIDATION.LATITUDE_MAX&&n>=t.VALIDATION.LONGITUDE_MIN&&n<=t.VALIDATION.LONGITUDE_MAX&&(a.location.latitude=r,a.location.longitude=n)}e.location.method&&(a.location.method=this.sanitizeString(e.location.method))}if(void 0!==e.prayer_method){const t=parseInt(e.prayer_method);isNaN(t)||(a.prayer_method=t)}return"boolean"==typeof e.first_time_setup&&(a.first_time_setup=e.first_time_setup),{valid:!0,data:a,error:null}},validateFastingData(e){const a={};for(const[r,n]of Object.entries(e))if(/^\d{4}-\d{2}$/.test(r)&&Array.isArray(n)){const e=n.filter(e=>"number"==typeof e&&t.AYYAMUL_BIDH.DATES.includes(e));e.length>0&&(a[r]=e)}return{valid:!0,data:a,error:null}},validateCacheData(t){const e={};for(const[a,r]of Object.entries(t))r&&"object"==typeof r&&r.timestamp&&"number"==typeof r.timestamp&&(e[a]={data:this.deepClone(r.data),timestamp:r.timestamp});return{valid:!0,data:e,error:null}},isValidTimeFormat(t){const e=String(t).replace(/\s*\([^)]*\)\s*$/,"").trim();return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?$/.test(e)},sanitizeString(t){if("string"!=typeof t)return"";const e=document.createElement("div");return e.textContent=String(t),e.innerHTML.trim()},deepClone(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(Array.isArray(t))return t.map(t=>this.deepClone(t));const e={};for(const a of Object.keys(t))"__proto__"!==a&&"constructor"!==a&&"prototype"!==a&&(e[a]=this.deepClone(t[a]));return e}},a={save(t,e){try{const a=JSON.stringify(e);return localStorage.setItem(t,a),!0}catch(a){return!1}},get(a){try{const r=localStorage.getItem(a);if(null===r)return null;const n=JSON.parse(r);let i;return i=a===t.STORAGE_KEYS.APP_CONFIG?e.validateStorageData(n,"config"):a===t.STORAGE_KEYS.FASTING_DATA?e.validateStorageData(n,"fasting"):a===t.STORAGE_KEYS.CACHE?e.validateStorageData(n,"cache"):e.validateStorageData(n,"unknown"),i.valid?i.data:null}catch(r){return null}},remove(t){try{return localStorage.removeItem(t),!0}catch(e){return!1}},clear(){try{return Object.values(t.STORAGE_KEYS).forEach(t=>localStorage.removeItem(t)),!0}catch(e){return!1}},exportData(){try{return{app_config:this.get(t.STORAGE_KEYS.APP_CONFIG),puasa_ayyamul_bidh:this.get(t.STORAGE_KEYS.FASTING_DATA),exported_at:(new Date).toISOString()}}catch(e){return null}},importData(a){try{if(a.app_config){const r=e.validateStorageData(a.app_config,"config");r.valid&&this.save(t.STORAGE_KEYS.APP_CONFIG,r.data)}if(a.puasa_ayyamul_bidh){const r=e.validateStorageData(a.puasa_ayyamul_bidh,"fasting");r.valid&&this.save(t.STORAGE_KEYS.FASTING_DATA,r.data)}return!0}catch(r){return!1}},isCacheValid(e,a){const r=(this.get(t.STORAGE_KEYS.CACHE)||{})[e];if(!r||!r.timestamp)return!1;return(new Date).getTime()-r.timestamp<a},saveCache(e,a){const r=this.get(t.STORAGE_KEYS.CACHE)||{};r[e]={data:a,timestamp:(new Date).getTime()},this.save(t.STORAGE_KEYS.CACHE,r)},getCache(e){const a=(this.get(t.STORAGE_KEYS.CACHE)||{})[e];return a?a.data:null}},r={formatDate:(t,e="long")=>new Intl.DateTimeFormat("id-ID",{short:{day:"numeric",month:"numeric",year:"numeric"},long:{weekday:"long",day:"numeric",month:"long",year:"numeric"},iso:{year:"numeric",month:"2-digit",day:"2-digit"}}[e]).format(t),formatTime:t=>t&&"string"==typeof t?t.substring(0,5):"--:--",getCurrentDate:()=>new Date,addDays(t,e){const a=new Date(t);return a.setDate(a.getDate()+e),a},diffDays(t,e){const a=Math.abs(e-t);return Math.round(a/864e5)},sanitizeHTML(t){if("string"!=typeof t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML},sanitizeInput(t){return this.sanitizeHTML(t)},validateCoordinates(t,e){const a=parseFloat(t),r=parseFloat(e);return isNaN(a)||isNaN(r)?{valid:!1,error:"Koordinat harus berupa angka"}:a<-90||a>90?{valid:!1,error:"Latitude harus antara -90 dan 90"}:r<-180||r>180?{valid:!1,error:"Longitude harus antara -180 dan 180"}:{valid:!0,latitude:a,longitude:r}},throttle(t,e){let a=0;return function(...r){const n=(new Date).getTime();if(!(n-a<e))return a=n,t(...r)}},debounce(t,e){let a;return function(...r){clearTimeout(a),a=setTimeout(()=>t.apply(this,r),e)}},formatDateForAPI(t){const e=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),r=t.getFullYear();return"".concat(e,"-").concat(a,"-").concat(r)},calculateCountdown(t){if(!t)return"";const e=new Date,[a,r]=t.split(":").map(Number),n=new Date;n.setHours(a,r,0,0),n<e&&n.setDate(n.getDate()+1);const i=n-e,o=Math.floor(i/36e5),s=Math.floor(i%36e5/6e4);return o>0?"".concat(o," jam ").concat(s," menit"):"".concat(s," menit")},isOnline:()=>navigator.onLine,showToast(t,e="info"){const a={success:"bg-success text-white",error:"bg-danger text-white",warning:"bg-warning text-dark",info:"bg-info text-white"},r=a[e]||a.info;let n=document.getElementById("toastContainer");n||(n=document.createElement("div"),n.id="toastContainer",n.className="toast-container position-fixed bottom-0 end-0 p-3",n.style.zIndex="9999",document.body.appendChild(n));const i="toast-".concat(Date.now()),o=document.createElement("div");o.id=i,o.className="toast ".concat(r),o.setAttribute("role","alert"),o.setAttribute("aria-live","assertive"),o.setAttribute("aria-atomic","true");const s=document.createElement("div");s.className="toast-body d-flex justify-content-between align-items-center";const c=document.createElement("span");c.textContent=t;const l=document.createElement("button");l.type="button",l.className="btn-close btn-close-white",l.setAttribute("data-bs-dismiss","toast"),l.setAttribute("aria-label","Close"),s.appendChild(c),s.appendChild(l),o.appendChild(s),n.appendChild(o);new bootstrap.Toast(o,{autohide:!0,delay:5e3}).show(),o.addEventListener("hidden.bs.toast",()=>{o.remove()})},downloadJSON(t,e="data.json"){const a=JSON.stringify(t,null,2),r=new Blob([a],{type:"application/json"}),n=URL.createObjectURL(r),i=document.createElement("a");i.href=n,i.download=e,i.click(),URL.revokeObjectURL(n)},parseJSONFile:async t=>new Promise((e,a)=>{const r=new FileReader;r.onload=t=>{try{const a=JSON.parse(t.target.result);e(a)}catch(r){a(new Error("File JSON tidak valid"))}},r.onerror=()=>a(new Error("Gagal membaca file")),r.readAsText(t)}),hijriMonthNames:["Muharram","Safar","Rabiul Awal","Rabiul Akhir","Jumadil Awal","Jumadil Akhir","Rajab","Sha'ban","Ramadan","Syawal","Dzulqa'dah","Dzulhijjah"],getHijriMonthName(t){return this.hijriMonthNames[t-1]||""},dayNames:["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"],getDayName(t){return this.dayNames[t]||""},getIndonesianTimezone(){const t=-(new Date).getTimezoneOffset()/60;return 7===t?"WIB":8===t?"WITA":9===t?"WIT":"WIB"}};class n{constructor(e=t.API.BASE_URL){this.baseURL=e,this.defaultMethod=t.API.DEFAULT_METHOD}async _fetchFromAPI(t){const e=await fetch(t);if(!e.ok)throw new Error("HTTP error! status: ".concat(e.status));const a=await e.json();if(200!==a.code)throw new Error("API error: "+a.status);return a}_buildUrlWithMethodParams(e,a){let r="".concat(e,"&method=").concat(a);if(99===a){const e=t.API.KEMENAG_CUSTOM;r+="&methodSettings=".concat(e.methodSettings),r+="&tune=".concat(e.tune)}return r}async getTimingsByCity(t,e,a=this.defaultMethod,n=null){try{const i=n||r.formatDateForAPI(new Date),o="".concat(this.baseURL,"/timingsByCity/").concat(i,"?city=").concat(encodeURIComponent(t),"&country=").concat(encodeURIComponent(e)),s=this._buildUrlWithMethodParams(o,a),c=await this._fetchFromAPI(s);return this.parseTimingsData(c.data)}catch(i){throw i}}async getTimingsByCoordinates(t,e,a=this.defaultMethod,n=null){try{const i=n||r.formatDateForAPI(new Date),o="".concat(this.baseURL,"/timings/").concat(i,"?latitude=").concat(t,"&longitude=").concat(e),s=this._buildUrlWithMethodParams(o,a),c=await this._fetchFromAPI(s);return this.parseTimingsData(c.data)}catch(i){throw i}}async getMonthlyCalendar(t,e,a,r,n=this.defaultMethod){try{const i="".concat(this.baseURL,"/calendarByCity/").concat(a,"/").concat(r,"?city=").concat(encodeURIComponent(t),"&country=").concat(encodeURIComponent(e)),o=this._buildUrlWithMethodParams(i,n);return(await this._fetchFromAPI(o)).data.map(t=>this.parseTimingsData(t))}catch(i){throw i}}async getMonthlyCalendarByCoordinates(t,e,a,r,n=this.defaultMethod){try{const i="".concat(this.baseURL,"/calendar/").concat(a,"/").concat(r,"?latitude=").concat(t,"&longitude=").concat(e),o=this._buildUrlWithMethodParams(i,n);return(await this._fetchFromAPI(o)).data.map(t=>this.parseTimingsData(t))}catch(i){throw i}}parseTimingsData(t){var a,r,n,i,o,s,c,l,h,d,u,m,y;const g=e.validateDateData(t.date);g.valid;const p=e.validatePrayerTimings(t.timings);if(!p.valid)throw new Error("Invalid prayer timings from API: "+p.error);const A=g.data||t.date,D=p.data;return{date:{gregorian:(null==(a=A.gregorian)?void 0:a.date)||t.date.gregorian.date,hijri:(null==(r=A.hijri)?void 0:r.date)||t.date.hijri.date,readable:A.readable||t.date.readable,gregorianDay:(null==(n=A.gregorian)?void 0:n.day)||t.date.gregorian.day,gregorianMonth:(null==(i=A.gregorian)?void 0:i.month)||t.date.gregorian.month.en,gregorianYear:(null==(o=A.gregorian)?void 0:o.year)||t.date.gregorian.year,hijriDay:(null==(s=A.hijri)?void 0:s.day)||t.date.hijri.day,hijriMonth:(null==(l=null==(c=A.hijri)?void 0:c.month)?void 0:l.en)||t.date.hijri.month.en,hijriMonthAr:(null==(d=null==(h=A.hijri)?void 0:h.month)?void 0:d.ar)||t.date.hijri.month.ar,hijriMonthNumber:(null==(m=null==(u=A.hijri)?void 0:u.month)?void 0:m.number)||t.date.hijri.month.number,hijriYear:(null==(y=A.hijri)?void 0:y.year)||t.date.hijri.year},timings:D}}async getPrayerTimesWithCache(e,r=this.defaultMethod){const n="prayer_times_".concat(JSON.stringify(e)),i=t.CACHE.PRAYER_TIMES_MAX_AGE;if(a.isCacheValid(n,i))return a.getCache(n);let o;try{if(e.city&&e.country)o=await this.getTimingsByCity(e.city,e.country,r);else{if(!e.latitude||!e.longitude)throw new Error("Invalid location data");o=await this.getTimingsByCoordinates(e.latitude,e.longitude,r)}return a.saveCache(n,o),o}catch(s){const t=a.getCache(n);if(t)return t;throw s}}getNextPrayerTime(t){const e=new Date,a=60*e.getHours()+e.getMinutes(),n=[{name:"Subuh",time:t.Fajr},{name:"Dzuhur",time:t.Dhuhr},{name:"Ashar",time:t.Asr},{name:"Maghrib",time:t.Maghrib},{name:"Isya",time:t.Isha}];for(const i of n){const[t,e]=i.time.split(":").map(Number);if(60*t+e>a)return{name:i.name,time:r.formatTime(i.time),countdown:r.calculateCountdown(i.time)}}return{name:"Subuh",time:r.formatTime(t.Fajr),countdown:r.calculateCountdown(t.Fajr)}}getCurrentPrayerTime(t){const e=new Date,a=60*e.getHours()+e.getMinutes(),r=[{name:"Subuh",start:t.Fajr,end:t.Sunrise},{name:"Dzuhur",start:t.Dhuhr,end:t.Asr},{name:"Ashar",start:t.Asr,end:t.Maghrib},{name:"Maghrib",start:t.Maghrib,end:t.Isha},{name:"Isya",start:t.Isha,end:"23:59"}];for(const n of r){const[t,e]=n.start.split(":").map(Number),[r,i]=n.end.split(":").map(Number);if(a>=60*t+e&&a<60*r+i)return n.name}return null}static getCalculationMethods(){return t.PRAYER_METHODS}}class i{constructor(t={}){this.queue=[],this.processing=!1,this.maxConcurrent=t.maxConcurrent||3,this.delayBetweenRequests=t.delay||150,this.activeRequests=0,this.retryAttempts=t.retryAttempts||2,this.retryDelay=t.retryDelay||1e3}async enqueue(t,e=0){return new Promise((a,r)=>{this.queue.push({fn:t,resolve:a,reject:r,priority:e,attempts:0}),this.queue.sort((t,e)=>e.priority-t.priority),this.processing||this.processQueue()})}async processQueue(){if(!this.processing){for(this.processing=!0;this.queue.length>0||this.activeRequests>0;){for(;this.activeRequests>=this.maxConcurrent;)await this.delay(50);if(0===this.queue.length){if(0===this.activeRequests)break;await this.delay(50);continue}const t=this.queue.shift();this.activeRequests++,this.executeWithRetry(t).then(t.resolve).catch(t.reject).finally(()=>{this.activeRequests--}),this.queue.length>0&&await this.delay(this.delayBetweenRequests)}this.processing=!1}}async executeWithRetry(t){try{return await t.fn()}catch(e){if((e.message.includes("429")||e.message.includes("Too Many Requests"))&&t.attempts<this.retryAttempts){t.attempts++;const e=this.retryDelay*Math.pow(2,t.attempts-1);return await this.delay(e),this.executeWithRetry(t)}throw e}}delay(t){return new Promise(e=>setTimeout(e,t))}clear(){this.queue=[]}getStatus(){return{queued:this.queue.length,active:this.activeRequests,processing:this.processing}}}class o{static gregorianToHijri(t){const e=new Date(622,6,16),a=t.getTime()-e.getTime(),r=Math.floor(a/864e5),n=354.36667;let i=Math.floor(r/n)+1;let o=1,s=r-Math.floor((i-1)*n);const c=[30,29,30,29,30,29,30,29,30,29,30,29];for(;s>c[o-1]&&o<12;)s-=c[o-1],o++;const l=Math.ceil(s);return l<=0&&(o--,o<=0&&(o=12,i--)),{day:Math.max(1,Math.min(30,l)),month:o,year:i,monthName:this.getMonthName(o),calculated:!0,accuracy:"approximate"}}static getMonthName(t){return["Muharram","Safar","Rabi' al-Awwal","Rabi' al-Thani","Jumada al-Ula","Jumada al-Akhirah","Rajab","Sha'ban","Ramadan","Shawwal","Dhu al-Qi'dah","Dhu al-Hijjah"][t-1]||"Unknown"}static isAyyamulBidh(t){return t>=13&&t<=15}}class s{constructor(e=t.API.BASE_URL){this.baseURL=e,this.AYYAMUL_BIDH_DATES=t.AYYAMUL_BIDH.DATES,this.requestQueue=new i({maxConcurrent:3,delay:300,retryAttempts:2,retryDelay:1e3})}async gregorianToHijri(t){const r="hijri_".concat(t),n=a.getCache(r);if(n)return n;try{const n=await this.requestQueue.enqueue(async()=>{const e="".concat(this.baseURL,"/gToH/").concat(t),a=await fetch(e);if(!a.ok)throw new Error("HTTP error! status: ".concat(a.status));const r=await a.json();if(200!==r.code)throw new Error("API error: "+r.status);return r}),i=e.validateHijriDate({day:n.data.hijri.day,month:n.data.hijri.month.number,monthName:n.data.hijri.month.en,year:n.data.hijri.year,formatted:"".concat(n.data.hijri.day," ").concat(n.data.hijri.month.en," ").concat(n.data.hijri.year," H")});if(!i.valid)throw new Error("Invalid Hijri date from API: "+i.error);const o={...i.data,monthNameAr:e.sanitizeString(n.data.hijri.month.ar)};return a.saveCache(r,o),o}catch(i){try{const[e,n,i]=t.split("-").map(Number),s=new Date(i,n-1,e),c=o.gregorianToHijri(s),l={day:c.day,month:c.month,monthName:c.monthName,year:c.year,formatted:"".concat(c.day," ").concat(c.monthName," ").concat(c.year," H"),monthNameAr:"",isFallback:!0};return a.saveCache(r,l),l}catch(s){throw i}}}async hijriToGregorian(t){const r="gregorian_".concat(t),n=a.getCache(r);if(n)return n;try{const n=await this.requestQueue.enqueue(async()=>{const e="".concat(this.baseURL,"/hToG/").concat(t),a=await fetch(e);if(!a.ok)throw new Error("HTTP error! status: ".concat(a.status));const r=await a.json();if(200!==r.code)throw new Error("API error: "+r.status);return r}),i={day:parseInt(n.data.gregorian.day),month:parseInt(n.data.gregorian.month.number),monthName:e.sanitizeString(n.data.gregorian.month.en),year:parseInt(n.data.gregorian.year),formatted:e.sanitizeString(n.data.gregorian.date)};return a.saveCache(r,i),i}catch(i){throw i}}async getCurrentHijriDate(){const t=new Date,e=r.formatDateForAPI(t);return await this.gregorianToHijri(e)}async getAyyamulBidhDates(t,e){const a=[];for(const n of this.AYYAMUL_BIDH_DATES){const i="".concat(String(n).padStart(2,"0"),"-").concat(String(t).padStart(2,"0"),"-").concat(e);try{const r=await this.hijriToGregorian(i);a.push({hijriDay:n,hijriMonth:t,hijriYear:e,gregorianDate:new Date(r.year,r.month-1,r.day),formatted:r.formatted})}catch(r){}}return a}isAyyamulBidhDay(t){return this.AYYAMUL_BIDH_DATES.includes(t.day)}calculateDaysUntilNextAyyamulBidh(t){const e=t.day;if(e<13){const t=13-e;return{daysUntil:t,nextDate:13,status:"upcoming",message:"ðŸŒ™ Tinggal ".concat(t," hari lagi menuju Ayyamul Bidh bulan ini!")}}if(e>=13&&e<=15)return{daysUntil:0,nextDate:e,status:"current",message:"âœ¨ HARI INI PUASA AYYAMUL BIDH! (".concat(e," ").concat(t.monthName," ").concat(t.year," H)")};{const t=30-e+13;return{daysUntil:t,nextDate:13,status:"next_month",message:"ðŸ“… Ayyamul Bidh bulan depan dalam ".concat(t," hari lagi")}}}generateMonthlyCalendarInstant(t,e){const a=[],r=new Date(e,t,0).getDate();for(let n=1;n<=r;n++){const r=new Date(e,t-1,n),i=o.gregorianToHijri(r);a.push({gregorianDay:n,gregorianMonth:t,gregorianYear:e,hijriDay:i.day,hijriMonth:i.month,hijriYear:i.year,hijriMonthName:i.monthName,isAyyamulBidh:this.AYYAMUL_BIDH_DATES.includes(i.day),isApproximate:!0})}return a}async generateMonthlyCalendar(t,e,a=!1){const r=[];if(a)for(let i=1;i<=30;i++){const a="".concat(String(i).padStart(2,"0"),"-").concat(String(t).padStart(2,"0"),"-").concat(e);try{const n=await this.hijriToGregorian(a);r.push({hijriDay:i,hijriMonth:t,hijriYear:e,gregorianDay:n.day,gregorianMonth:n.month,gregorianYear:n.year,isAyyamulBidh:this.AYYAMUL_BIDH_DATES.includes(i)})}catch(n){break}}else{const a=new Date(e,t,0).getDate(),n=[];for(let r=1;r<=a;r++){const a="".concat(String(r).padStart(2,"0"),"-").concat(String(t).padStart(2,"0"),"-").concat(e);n.push(this.gregorianToHijri(a).then(a=>({gregorianDay:r,gregorianMonth:t,gregorianYear:e,hijriDay:a.day,hijriMonth:a.month,hijriYear:a.year,hijriMonthName:a.monthName,isAyyamulBidh:this.AYYAMUL_BIDH_DATES.includes(a.day),isFallback:a.isFallback||!1})).catch(t=>null))}const i=await Promise.all(n);r.push(...i.filter(t=>null!==t))}return r}getHijriMonthName(t){return r.getHijriMonthName(t)}async getUpcomingAyyamulBidh(t=3){const e=[],a=await this.getCurrentHijriDate();for(let r=0;r<t;r++){let t=a.month+r,n=a.year;t>12&&(t-=12,n+=1);const i=await this.getAyyamulBidhDates(t,n);e.push({hijriMonth:t,hijriMonthName:this.getHijriMonthName(t),hijriYear:n,dates:i})}return e}}class c{constructor(){this.storageKey=t.STORAGE_KEYS.FASTING_DATA,this.loadData()}loadData(){this.data=a.get(this.storageKey)||{}}saveData(){a.save(this.storageKey,this.data)}getMonthKey(t,e){return"".concat(e,"-").concat(String(t).padStart(2,"0"))}markFasting(e,a,r){if(!t.AYYAMUL_BIDH.DATES.includes(e))return!1;const n=this.getMonthKey(a,r);return this.data[n]||(this.data[n]=[]),!this.data[n].includes(e)&&(this.data[n].push(e),this.data[n].sort(),this.saveData(),!0)}unmarkFasting(t,e,a){const r=this.getMonthKey(e,a);if(!this.data[r])return!1;const n=this.data[r].indexOf(t);return n>-1&&(this.data[r].splice(n,1),0===this.data[r].length&&delete this.data[r],this.saveData(),!0)}toggleFasting(t,e,a){return this.isFastingMarked(t,e,a)?(this.unmarkFasting(t,e,a),!1):(this.markFasting(t,e,a),!0)}isFastingMarked(t,e,a){const r=this.getMonthKey(e,a);return!!this.data[r]&&this.data[r].includes(t)}getMonthlyStats(t,e){const a=this.getMonthKey(t,e),n=this.data[a]||[],i=n.length,o=3===i,s=Math.round(i/3*100);return{month:t,monthName:r.getHijriMonthName(t),year:e,markedDays:n,totalDays:i,isComplete:o,percentage:s,status:3===i?"complete":i>0?"partial":"none"}}getYearlyStats(t){let e=0,a=0,r=0;const n=[];for(let i=1;i<=12;i++){const o=this.getMonthlyStats(i,t);n.push(o),e+=o.totalDays,o.isComplete?a++:o.totalDays>0&&r++}return{year:t,totalDays:e,maxPossibleDays:36,percentage:Math.round(e/36*100),completeMonths:a,partialMonths:r,emptyMonths:12-a-r,monthlyDetails:n}}getTotalFastingDays(){let t=0;for(const e in this.data)t+=this.data[e].length;return t}getCurrentStreak(e,a){let r=0,n=e-1,i=a;for(;;){n<1&&(n=12,i--);if(!this.getMonthlyStats(n,i).isComplete)break;if(r++,n--,r>=t.VALIDATION.MAX_STREAK_CALCULATION)break}return r}getLongestStreak(){const t=Object.keys(this.data).filter(t=>3===this.data[t].length).sort();if(0===t.length)return 0;let e=1,a=1;for(let r=1;r<t.length;r++){const[n,i]=t[r-1].split("-").map(Number),[o,s]=t[r].split("-").map(Number);o===n&&s===i+1||o===n+1&&12===i&&1===s?(a++,e=Math.max(e,a)):a=1}return e}getFastingHistory(){const t=[];for(const e in this.data){const[a,n]=e.split("-").map(Number);t.push({monthKey:e,month:n,monthName:r.getHijriMonthName(n),year:a,days:this.data[e],...this.getMonthlyStats(n,a)})}return t.sort((t,e)=>t.year!==e.year?e.year-t.year:e.month-t.month),t}exportHistory(){return{puasa_ayyamul_bidh:this.data,exported_at:(new Date).toISOString(),total_days:this.getTotalFastingDays(),longest_streak:this.getLongestStreak()}}importHistory(t){try{if(t.puasa_ayyamul_bidh){const a=e.validateStorageData(t.puasa_ayyamul_bidh,"fasting");return!!a.valid&&(this.data=e.deepClone(a.data),this.saveData(),!0)}return!1}catch(a){return!1}}resetAll(){this.data={},this.saveData()}}class l{constructor(){this.prayerTimesAPI=new n,this.hijriCalendar=new s,this.tracker=new c,this.config=null,this.currentData={todayDate:null,prayerTimes:null,hijriDate:null,ayyamulBidhInfo:null},this.intervals=[],this.clockInterval=null}async init(){try{this.config=a.get(t.STORAGE_KEYS.APP_CONFIG),this.config&&this.config.first_time_setup?await this.loadApp():await this.showSetupWizard()}catch(e){this.showError("Gagal menginisialisasi aplikasi")}}async showSetupWizard(){const t=document.getElementById("setupModal");if(t){new bootstrap.Modal(t).show()}this.setupLocationFormListeners()}setupLocationFormListeners(){const t=document.getElementById("autoDetectLocation");t&&t.addEventListener("click",()=>this.autoDetectLocation());const e=document.getElementById("setupForm");e&&e.addEventListener("submit",t=>{t.preventDefault(),this.saveLocationFromForm()})}autoDetectLocation(){if(!navigator.geolocation)return void this.showError("Browser Anda tidak mendukung deteksi lokasi");const t=document.getElementById("locationStatus");t&&(t.textContent="Mendeteksi lokasi..."),navigator.geolocation.getCurrentPosition(async e=>{const a=e.coords.latitude,r=e.coords.longitude;await this.saveLocation({latitude:a,longitude:r,method:"gps"}),t&&(t.textContent="Lokasi terdeteksi!",t.className="text-success"),setTimeout(()=>this.completeSetup(),1e3)},e=>{this.showError("Gagal mendeteksi lokasi. Silakan pilih kota secara manual."),t&&(t.textContent="Gagal mendeteksi lokasi",t.className="text-danger")})}async saveLocationFromForm(){var t,e;const a=null==(t=document.getElementById("citySelect"))?void 0:t.value,r=(null==(e=document.getElementById("countryInput"))?void 0:e.value)||"Indonesia";a?(await this.saveLocation({city:a,country:r,method:"manual"}),this.completeSetup()):this.showError("Pilih kota terlebih dahulu")}async saveLocation(e){this.config={location:e,prayer_method:t.API.DEFAULT_METHOD,first_time_setup:!0},a.save(t.STORAGE_KEYS.APP_CONFIG,this.config)}async completeSetup(){const t=document.getElementById("setupModal");if(t){const e=bootstrap.Modal.getInstance(t);e&&e.hide()}await this.loadApp()}async loadApp(){try{this.showLoading(!0),await Promise.all([this.loadTodayDate(),this.loadPrayerTimes()]),await this.loadHijriDate(),await this.loadAyyamulBidhInfo(),this.renderDashboard(),this.setupAutoUpdate(),this.setupClock(),this.showLoading(!1)}catch(t){this.showError("Gagal memuat data. Menggunakan data cache..."),this.showLoading(!1)}}async loadTodayDate(){this.currentData.todayDate=r.getCurrentDate()}async loadPrayerTimes(){try{const e=this.config.location,a=this.config.prayer_method||t.API.DEFAULT_METHOD;this.currentData.prayerTimes=await this.prayerTimesAPI.getPrayerTimesWithCache(e,a)}catch(e){r.showToast("Gagal memuat waktu sholat terbaru. Menggunakan data tersimpan.","warning")}}async loadHijriDate(){try{this.currentData.hijriDate=await this.hijriCalendar.getCurrentHijriDate()}catch(t){r.showToast("Gagal memuat tanggal Hijri. Periksa koneksi internet.","error")}}async loadAyyamulBidhInfo(){try{this.currentData.hijriDate?this.currentData.ayyamulBidhInfo=this.hijriCalendar.calculateDaysUntilNextAyyamulBidh(this.currentData.hijriDate):r.showToast("Informasi Ayyamul Bidh tidak dapat dimuat","warning")}catch(t){r.showToast("Gagal menghitung info Ayyamul Bidh","error")}}renderDashboard(){this.updateDateDisplay(),this.updatePrayerTimesDisplay(),this.updateAyyamulBidhDisplay(),this.updateStatsDisplay()}updateDateDisplay(){const t=document.getElementById("gregorianDate");t&&this.currentData.todayDate&&(t.textContent=r.formatDate(this.currentData.todayDate,"long"));const e=document.getElementById("hijriDate");e&&this.currentData.hijriDate&&(e.textContent=this.currentData.hijriDate.formatted)}updatePrayerTimesDisplay(){if(!this.currentData.prayerTimes)return;const t=this.currentData.prayerTimes.timings,e={fajrTime:t.Fajr,dhuhrTime:t.Dhuhr,asrTime:t.Asr,maghribTime:t.Maghrib,ishaTime:t.Isha,imsakTime:t.Imsak};for(const[o,s]of Object.entries(e)){const t=document.getElementById(o);t&&(t.textContent=r.formatTime(s))}const a=this.prayerTimesAPI.getNextPrayerTime(t),n=document.getElementById("nextPrayer");if(n&&a){n.textContent="";const t=document.createElement("strong");t.textContent=a.name;const e=document.createTextNode(" - ".concat(a.time)),r=document.createElement("br"),i=document.createElement("small");i.className="text-muted",i.textContent="Akan tiba dalam ".concat(a.countdown),n.appendChild(t),n.appendChild(e),n.appendChild(r),n.appendChild(i)}const i=this.prayerTimesAPI.getCurrentPrayerTime(t);if(i){document.querySelectorAll(".prayer-time-card").forEach(t=>{t.classList.remove("active-prayer")});const t=document.querySelector('[data-prayer="'.concat(i.toLowerCase(),'"]'));t&&t.classList.add("active-prayer")}}updateAyyamulBidhDisplay(){const t=document.getElementById("ayyamulBidhMessage"),e=document.getElementById("ayyamulBidhProgress");if(!this.currentData.ayyamulBidhInfo)return t&&(t.textContent="Informasi Ayyamul Bidh tidak tersedia. Silakan refresh halaman atau periksa koneksi internet.",t.className="alert alert-warning"),void(e&&(e.style.width="0%"));const a=this.currentData.ayyamulBidhInfo;t&&(t.textContent=a.message,"current"===a.status?t.className="alert alert-success fw-bold":t.className="alert alert-info");const r=document.getElementById("ayyamulBidhCountdown");if(r&&a.daysUntil>0&&(r.textContent=a.daysUntil),e&&this.currentData.hijriDate){const t=this.currentData.hijriDate.month,a=this.currentData.hijriDate.year,r=this.tracker.getMonthlyStats(t,a).totalDays,n=r/3*100;e.style.width="".concat(n,"%"),e.setAttribute("aria-valuenow",n),e.textContent="".concat(r,"/3 hari (").concat(Math.round(n),"%)")}}updateStatsDisplay(){if(!this.currentData.hijriDate)return;const t=this.currentData.hijriDate.month,e=this.currentData.hijriDate.year,a=this.tracker.getMonthlyStats(t,e),r=document.getElementById("monthlyStats");r&&(r.textContent="".concat(a.totalDays,"/3"));const n=this.tracker.getYearlyStats(e),i=document.getElementById("yearlyStats");i&&(i.textContent="".concat(n.totalDays,"/36"));const o=this.tracker.getCurrentStreak(t,e),s=document.getElementById("currentStreak");s&&(s.textContent="".concat(o," bulan"))}setupAutoUpdate(){this.clearIntervals();const e=setInterval(()=>{this.updatePrayerTimesDisplay()},t.INTERVALS.PRAYER_COUNTDOWN_UPDATE);this.intervals.push(e);const a=setInterval(async()=>{await this.loadPrayerTimes(),this.updatePrayerTimesDisplay()},t.INTERVALS.DATA_REFRESH);this.intervals.push(a)}showLoading(t){const e=document.getElementById("loadingIndicator");e&&(e.style.display=t?"block":"none")}showError(t){r.showToast(t,"error")}clearIntervals(){this.intervals.forEach(t=>clearInterval(t)),this.intervals=[],this.clockInterval&&(clearInterval(this.clockInterval),this.clockInterval=null)}destroy(){this.clearIntervals()}setupClock(){this.clockInterval&&clearInterval(this.clockInterval),this.updateClock(),this.clockInterval=setInterval(()=>{this.updateClock()},t.INTERVALS.SECOND)}updateClock(){const t=document.getElementById("currentTime"),e=document.getElementById("currentTimezone");if(!t)return;const a=new Date,n=String(a.getHours()).padStart(2,"0"),i=String(a.getMinutes()).padStart(2,"0"),o=String(a.getSeconds()).padStart(2,"0");if(t.textContent="".concat(n,":").concat(i,":").concat(o),e){const t=r.getIndonesianTimezone();e.textContent=t}}async refresh(){await this.loadApp()}}document.addEventListener("DOMContentLoaded",()=>{(new l).init()}),document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("currentYear");if(t){const e=(new Date).getFullYear();t.textContent=e}}),window.addEventListener("beforeunload",()=>{window.app&&window.app.destroy()});export{c as F,s as H,n as P,a as S,r as U};
